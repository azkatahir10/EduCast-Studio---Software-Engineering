<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with AI - EduCast Studio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4bb543;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --warning: #ffc107;
            --user-bg: #e3f2fd;
            --ai-bg: #f5f5f5;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Navbar */
        .navbar {
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 1rem 2rem;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar-brand {
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .navbar-brand i {
            margin-right: 10px;
            font-size: 1.8rem;
        }
        
        .navbar-nav {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        
        .nav-item {
            position: relative;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: white;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .page-header h1 {
            font-size: 2.5rem;
            color: var(--secondary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        
        .ai-status {
            background: var(--success);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .page-header p {
            color: var(--gray);
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
        }
        
        /* Chat Header */
        .chat-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chat-header-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .chat-title h2 {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        
        .chat-title p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .chat-stats {
            display: flex;
            gap: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        /* Chat Messages */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            background-color: #fafbfe;
        }
        
        /* Message Styles */
        .message {
            max-width: 85%;
            padding: 1rem 1.5rem;
            border-radius: 18px;
            position: relative;
            animation: fadeIn 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid transparent;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
            border-left: 4px solid var(--accent);
        }
        
        .ai-message {
            background: white;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            border: 1px solid var(--light-gray);
            border-right: 4px solid var(--warning);
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .ai-message .message-header {
            border-bottom: 1px solid var(--light-gray);
        }
        
        .message-sender {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }
        
        .user-message .message-sender {
            color: white;
        }
        
        .ai-message .message-sender {
            color: var(--secondary);
        }
        
        .message-time {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .message-content {
            line-height: 1.6;
        }
        
        .ai-message .message-content {
            color: var(--dark);
        }
        
        /* Message Actions */
        .message-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .message:hover .message-actions {
            opacity: 1;
        }
        
        .action-button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 0.9rem;
        }
        
        .ai-message .action-button {
            background: var(--light-gray);
            color: var(--gray);
        }
        
        .action-button:hover {
            transform: scale(1.1);
            background: white;
            color: var(--primary);
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 18px;
            width: fit-content;
            align-self: flex-start;
            margin-bottom: 1rem;
            border-bottom-left-radius: 5px;
            border-right: 4px solid var(--warning);
        }
        
        .typing-text {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dots span {
            width: 8px;
            height: 8px;
            background-color: var(--gray);
            border-radius: 50%;
            display: inline-block;
            animation: typing 1.5s infinite ease-in-out;
        }
        
        .typing-dots span:nth-child(1) { animation-delay: 0s; }
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 100% { transform: translateY(0); opacity: 0.5; }
            50% { transform: translateY(-5px); opacity: 1; }
        }
        
        /* Chat Input */
        .chat-input-container {
            padding: 1.5rem 2rem;
            background: white;
            border-top: 1px solid var(--light-gray);
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }
        
        .input-wrapper {
            flex: 1;
            position: relative;
        }
        
        .chat-input {
            width: 100%;
            padding: 1rem 1.5rem 1rem 3rem;
            border: 2px solid var(--light-gray);
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafbfe;
            resize: none;
            min-height: 56px;
            max-height: 120px;
            line-height: 1.5;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .input-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 1.2rem;
        }
        
        .send-button {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 0.85rem 2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            height: 56px;
        }
        
        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .send-button:active {
            transform: translateY(0);
        }
        
        /* Suggestions */
        .suggestions-container {
            padding: 0 2rem 1.5rem;
            background: white;
            border-top: 1px solid var(--light-gray);
        }
        
        .suggestions-title {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        
        .suggestion {
            background-color: #f0f4ff;
            border: 1px solid #d1d9ff;
            border-radius: 20px;
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--primary);
        }
        
        .suggestion:hover {
            background-color: #e1e8ff;
            transform: translateY(-2px);
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        .action-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            width: 180px;
            border: 2px solid transparent;
        }
        
        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: var(--warning);
        }
        
        .action-icon {
            width: 60px;
            height: 60px;
            background: var(--light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .action-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 0.5rem;
        }
        
        .action-desc {
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--light-gray);
            margin-top: 2rem;
            background: white;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }
            
            .navbar-nav {
                gap: 1rem;
            }
            
            .nav-link span {
                display: none;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .chat-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
                padding: 1.5rem 1rem;
            }
            
            .chat-stats {
                width: 100%;
                justify-content: space-around;
            }
            
            .chat-messages {
                padding: 1rem;
            }
            
            .message {
                max-width: 95%;
            }
            
            .chat-input-container {
                padding: 1rem;
                flex-direction: column;
            }
            
            .send-button {
                width: 100%;
                justify-content: center;
            }
            
            .suggestions-container {
                padding: 0 1rem 1rem;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .action-card {
                width: 100%;
                max-width: 300px;
            }
        }
        
        @media (max-width: 480px) {
            .navbar-brand span {
                display: none;
            }
            
            .page-header h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .message {
                max-width: 100%;
            }
            
            .suggestions {
                flex-direction: column;
            }
            
            .suggestion {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <a href="/" class="navbar-brand">
            <i class="fas fa-podcast"></i>
            <span>EduCast Studio</span>
        </a>
        
        <ul class="navbar-nav">
            <li class="nav-item">
                <a href="/" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/collections" class="nav-link">
                    <i class="fas fa-book"></i>
                    <span>Collections</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/favourites" class="nav-link">
                    <i class="fas fa-heart"></i>
                    <span>Favourites</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/podcast-generation" class="nav-link">
                    <i class="fas fa-headphones"></i>
                    <span>Generate Podcast</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/chat" class="nav-link active">
                    <i class="fas fa-comments"></i>
                    <span>Chat</span>
                </a>
            </li>
        </ul>
        
        <div class="user-profile">
            <div class="user-avatar" id="userAvatar">
                <i class="fas fa-user"></i>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <h1>
                <i class="fas fa-robot" style="color: var(--primary);"></i>
                AI Chat Assistant
                <span class="ai-status" id="aiStatus">Online</span>
            </h1>
            <p>Ask me anything about books, podcasts, authors, or get personalized recommendations for your next read!</p>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="action-card" onclick="useSuggestionAction('books')">
                <div class="action-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="action-title">Book Recommendations</div>
                <div class="action-desc">Get personalized book suggestions</div>
            </div>
            
            <div class="action-card" onclick="useSuggestionAction('podcasts')">
                <div class="action-icon">
                    <i class="fas fa-headphones"></i>
                </div>
                <div class="action-title">Podcast Discovery</div>
                <div class="action-desc">Find podcasts by topic or genre</div>
            </div>
            
            <div class="action-card" onclick="useSuggestionAction('authors')">
                <div class="action-icon">
                    <i class="fas fa-user-edit"></i>
                </div>
                <div class="action-title">Author Insights</div>
                <div class="action-desc">Learn about authors and their works</div>
            </div>
            
            <div class="action-card" onclick="useSuggestionAction('discussion')">
                <div class="action-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <div class="action-title">Book Discussions</div>
                <div class="action-desc">Discuss themes and characters</div>
            </div>
        </div>
        
        <!-- Chat Container -->
        <div class="chat-container">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-header-info">
                    <div class="chat-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="chat-title">
                        <h2>EduCast AI Assistant</h2>
                        <p>Specialized in books and podcasts</p>
                    </div>
                </div>
                
                <div class="chat-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="messageCount">0</div>
                        <div class="stat-label">Messages</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="sessionTime">0</div>
                        <div class="stat-label">Minutes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="topicsCount">0</div>
                        <div class="stat-label">Topics</div>
                    </div>
                </div>
            </div>
            
            <!-- Chat Messages -->
            <div class="chat-messages" id="chatMessages">
                <!-- Initial AI Message -->
                <div class="message ai-message">
                    <div class="message-header">
                        <div class="message-sender">
                            <i class="fas fa-robot"></i>
                            EduCast AI
                        </div>
                        <div class="message-time" id="initialTime">Just now</div>
                    </div>
                    <div class="message-content">
                        Hello! I'm your EduCast AI assistant, specialized in books and podcasts. I can help you discover new reads, recommend podcasts based on your interests, discuss authors, analyze book themes, and much more. What would you like to explore today?
                    </div>
                    <div class="message-actions">
                        <button class="action-button" title="Copy message">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="action-button" title="Save to notes">
                            <i class="fas fa-save"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                <div class="typing-text">EduCast AI is typing</div>
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            
            <!-- Suggestions -->
            <div class="suggestions-container" id="suggestionsContainer">
                <div class="suggestions-title">
                    <i class="fas fa-lightbulb"></i>
                    Quick suggestions:
                </div>
                <div class="suggestions" id="suggestions">
                    <div class="suggestion" onclick="useSuggestion(this)">Recommend a sci-fi book</div>
                    <div class="suggestion" onclick="useSuggestion(this)">Best educational podcasts</div>
                    <div class="suggestion" onclick="useSuggestion(this)">Tell me about Jane Austen</div>
                    <div class="suggestion" onclick="useSuggestion(this)">How to start a book club?</div>
                </div>
            </div>
            
            <!-- Chat Input -->
            <div class="chat-input-container">
                <div class="input-wrapper">
                    <div class="input-icon">
                        <i class="fas fa-comment-dots"></i>
                    </div>
                    <textarea class="chat-input" id="messageInput" placeholder="Type your question about books or podcasts..." rows="1"></textarea>
                </div>
                <button class="send-button" onclick="sendMessage()" id="sendButton">
                    <i class="fas fa-paper-plane"></i>
                    <span>Send</span>
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <div class="footer">
        <p>Â© 2023 EduCast Studio. AI Chat Assistant v2.0 | Responses are generated for demonstration purposes.</p>
    </div>

    <script>
        // Configuration
        let messageCount = 0;
        let sessionStartTime = new Date();
        let topics = new Set();
        let isTyping = false;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const token = localStorage.getItem('token');
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{"name": "Guest"}');
            
            if (!token) {
                window.location.href = '/authentication';
                return;
            }
            
            // Set user avatar
            const userAvatar = document.getElementById('userAvatar');
            userAvatar.innerHTML = currentUser.name.charAt(0).toUpperCase();
            userAvatar.title = `${currentUser.name} (${currentUser.email || 'User'})`;
            
            // Add logout functionality
            userAvatar.addEventListener('click', function() {
                if (confirm('Do you want to logout?')) {
                    localStorage.removeItem('token');
                    localStorage.removeItem('currentUser');
                    window.location.href = '/authentication';
                }
            });
            
            // Set initial time
            document.getElementById('initialTime').textContent = getCurrentTime();
            
            // Setup event listeners
            setupEventListeners();
            
            // Auto-focus on input
            setTimeout(() => {
                document.getElementById('messageInput').focus();
            }, 500);
            
            // Start session timer
            updateSessionTimer();
            setInterval(updateSessionTimer, 60000); // Update every minute
        });
        
        // Get current time in HH:MM format
        function getCurrentTime() {
            const now = new Date();
            return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        }
        
        // Setup event listeners
        function setupEventListeners() {
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            
            // Send message on Enter (but allow Shift+Enter for new line)
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
                
                // Auto-resize textarea
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // Send button click
            sendButton.addEventListener('click', sendMessage);
            
            // Copy message actions
            document.addEventListener('click', function(e) {
                if (e.target.closest('.action-button')) {
                    const button = e.target.closest('.action-button');
                    const messageContent = button.closest('.message').querySelector('.message-content').textContent;
                    
                    if (button.querySelector('.fa-copy')) {
                        // Copy to clipboard
                        navigator.clipboard.writeText(messageContent).then(() => {
                            showNotification('Message copied to clipboard!', 'success');
                        });
                    } else if (button.querySelector('.fa-save')) {
                        // Save to notes
                        saveToNotes(messageContent);
                    }
                }
            });
        }
        
        // Send message function
        async function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message || isTyping) return;
            
            // Clear input and reset height
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            // Add user message
            addMessage(message, 'user');
            
            // Show typing indicator
            showTypingIndicator();
            
            // Update stats
            updateStats(message);
            
            // Generate AI response after delay
            setTimeout(() => {
                hideTypingIndicator();
                const aiResponse = generateAIResponse(message);
                addMessage(aiResponse, 'ai');
            }, 1000 + Math.random() * 1500);
        }
        
        // Add message to chat
        function addMessage(content, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = `message ${sender}-message`;
            messageDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-sender">
                        ${sender === 'user' ? '<i class="fas fa-user"></i> You' : '<i class="fas fa-robot"></i> EduCast AI'}
                    </div>
                    <div class="message-time">${getCurrentTime()}</div>
                </div>
                <div class="message-content">${formatMessageContent(content)}</div>
                <div class="message-actions">
                    <button class="action-button" title="Copy message">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button class="action-button" title="Save to notes">
                        <i class="fas fa-save"></i>
                    </button>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Update message count
            messageCount++;
            document.getElementById('messageCount').textContent = messageCount;
        }
        
        // Format message content (add line breaks, etc.)
        function formatMessageContent(content) {
            // Replace newlines with <br> tags
            return content.replace(/\n/g, '<br>');
        }
        
        // Show typing indicator
        function showTypingIndicator() {
            isTyping = true;
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'flex';
            
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Hide typing indicator
        function hideTypingIndicator() {
            isTyping = false;
            document.getElementById('typingIndicator').style.display = 'none';
        }
        
        // Generate AI response
        function generateAIResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            // Extract topics from message
            extractTopics(lowerMessage);
            
            // Book recommendations
            if (lowerMessage.includes('recommend') || lowerMessage.includes('suggest') || lowerMessage.includes('book')) {
                if (lowerMessage.includes('sci-fi') || lowerMessage.includes('science fiction')) {
                    return "For science fiction, I highly recommend 'Dune' by Frank Herbert. It's an epic space opera exploring politics, religion, and ecology on a desert planet. Another great option is 'Neuromancer' by William Gibson, which pioneered the cyberpunk genre. If you prefer more modern sci-fi, 'The Three-Body Problem' by Liu Cixin offers fascinating hard science fiction concepts.";
                } else if (lowerMessage.includes('fantasy')) {
                    return "For fantasy lovers, you can't go wrong with 'The Name of the Wind' by Patrick Rothfuss. It's beautifully written with a unique magic system. 'Mistborn' by Brandon Sanderson has one of the most creative magic systems in fantasy. For classic fantasy, 'The Hobbit' by J.R.R. Tolkien is a delightful adventure that's more accessible than Lord of the Rings.";
                } else if (lowerMessage.includes('mystery') || lowerMessage.includes('thriller')) {
                    return "For mystery and thriller fans, I recommend 'Gone Girl' by Gillian Flynn for its brilliant psychological twists. 'The Silent Patient' by Alex Michaelides has one of the best plot twists in recent years. For classic mystery, you can't beat Agatha Christie's 'And Then There Were None' - it's the blueprint for the locked-room mystery.";
                } else {
                    return "Based on current trends, I'd recommend 'Project Hail Mary' by Andy Weir - it's a gripping sci-fi with humor and scientific accuracy. For literary fiction, 'The Midnight Library' by Matt Haig explores life choices in a beautiful way. If you enjoy historical fiction, 'The Book Thief' by Markus Zusak is a moving WWII story narrated by Death.";
                }
            }
            
            // Podcast recommendations
            if (lowerMessage.includes('podcast')) {
                if (lowerMessage.includes('educational') || lowerMessage.includes('learn')) {
                    return "For educational content, I highly recommend 'Stuff You Should Know' - each episode explains how something works in an engaging way. 'The TED Radio Hour' explores fascinating ideas from TED Talks with expert interviews. For science fans, 'Radiolab' makes complex scientific concepts accessible and entertaining through storytelling.";
                } else if (lowerMessage.includes('story') || lowerMessage.includes('narrative')) {
                    return "For narrative podcasts, 'Serial' revolutionized podcast storytelling with its investigative journalism format. 'This American Life' tells compelling human stories around a weekly theme. For fiction, 'Welcome to Night Vale' presents community news from a strange desert town in a unique horror-comedy format.";
                } else {
                    return "Some excellent general podcasts include 'The Daily' by The New York Times for current affairs, 'Freakonomics Radio' for exploring the hidden side of everything, and 'How I Built This' for inspiring entrepreneur stories. For book lovers specifically, 'What Should I Read Next?' helps listeners find their next favorite book.";
                }
            }
            
            // Author information
            if (lowerMessage.includes('author') || lowerMessage.includes('jane austen') || lowerMessage.includes('stephen king') || lowerMessage.includes('tolkien')) {
                if (lowerMessage.includes('jane austen')) {
                    return "Jane Austen (1775-1817) was an English novelist known for her six major novels, including 'Pride and Prejudice' and 'Sense and Sensibility'. Her works critique the British landed gentry at the end of the 18th century and are celebrated for their realism, irony, and social commentary. Austen's novels have inspired numerous adaptations and remain immensely popular today.";
                } else if (lowerMessage.includes('stephen king')) {
                    return "Stephen King (born 1947) is an American author of horror, supernatural fiction, suspense, and fantasy novels. He's published over 60 novels and 200 short stories, with many adapted into films and TV series. Some of his most famous works include 'The Shining', 'It', 'The Stand', and 'The Dark Tower' series. King writes 2,000 words daily and has sold over 350 million copies worldwide.";
                } else {
                    return "Authors I can tell you about include contemporary writers like Haruki Murakami (Japanese magical realism), Margaret Atwood (speculative fiction), and Chimamanda Ngozi Adichie (postcolonial literature), or classic authors like Charles Dickens, Virginia Woolf, and Ernest Hemingway. Which author would you like to learn more about?";
                }
            }
            
            // Book clubs and discussions
            if (lowerMessage.includes('book club') || lowerMessage.includes('discuss')) {
                return "Starting a book club is wonderful! Here are some tips: 1) Choose a consistent meeting time (monthly works well), 2) Pick diverse books across genres to keep it interesting, 3) Prepare discussion questions in advance, 4) Consider a hybrid format (in-person with virtual option), 5) Use platforms like Goodreads to organize. For discussion, focus on themes, character development, writing style, and personal connections to the story. Would you like specific discussion questions for a particular book?";
            }
            
            // General conversation
            const generalResponses = [
                "That's an interesting question! Based on your interest in that topic, I'd recommend exploring different genres to broaden your perspective. Have you tried audiobooks or podcasts as an alternative way to enjoy stories?",
                "Great question! The world of books and podcasts is vast. For more specific recommendations, you could tell me what you've enjoyed recently or what moods/themes you're interested in.",
                "I'd be happy to discuss that further. Reading habits can vary greatly - some prefer physical books while others enjoy e-books or audiobooks. What format do you prefer?",
                "That's a fascinating topic in literature/podcasting. I recommend checking out award-winning titles in that category, like Pulitzer Prize winners for fiction or Podcast Award winners for audio content."
            ];
            
            return generalResponses[Math.floor(Math.random() * generalResponses.length)];
        }
        
        // Use suggestion from button
        function useSuggestion(element) {
            const suggestionText = element.textContent;
            document.getElementById('messageInput').value = suggestionText;
            document.getElementById('messageInput').focus();
            
            // Trigger auto-resize
            const input = document.getElementById('messageInput');
            input.style.height = 'auto';
            input.style.height = (input.scrollHeight) + 'px';
        }
        
        // Use suggestion from quick action
        function useSuggestionAction(type) {
            let suggestion = '';
            
            switch(type) {
                case 'books':
                    suggestion = "I'm looking for book recommendations. What are some must-read novels from the past decade?";
                    break;
                case 'podcasts':
                    suggestion = "Can you recommend some educational podcasts about science and technology?";
                    break;
                case 'authors':
                    suggestion = "Tell me about contemporary authors who write magical realism.";
                    break;
                case 'discussion':
                    suggestion = "What are some good discussion questions for book clubs reading literary fiction?";
                    break;
            }
            
            document.getElementById('messageInput').value = suggestion;
            document.getElementById('messageInput').focus();
            
            // Trigger auto-resize
            const input = document.getElementById('messageInput');
            input.style.height = 'auto';
            input.style.height = (input.scrollHeight) + 'px';
        }
        
        // Extract topics from message
        function extractTopics(message) {
            const topicKeywords = {
                'sci-fi': ['sci-fi', 'science fiction', 'space', 'future', 'dystopian'],
                'fantasy': ['fantasy', 'magic', 'dragon', 'wizard', 'medieval'],
                'mystery': ['mystery', 'thriller', 'crime', 'detective', 'suspense'],
                'non-fiction': ['non-fiction', 'biography', 'history', 'science', 'memoir'],
                'podcast': ['podcast', 'audio', 'listen', 'episode'],
                'author': ['author', 'writer', 'biography', 'life story'],
                'classic': ['classic', 'old', '19th', '20th century', 'traditional']
            };
            
            for (const [topic, keywords] of Object.entries(topicKeywords)) {
                for (const keyword of keywords) {
                    if (message.includes(keyword)) {
                        topics.add(topic);
                        break;
                    }
                }
            }
            
            // Update topics count
            document.getElementById('topicsCount').textContent = topics.size;
        }
        
        // Update stats
        function updateStats(message) {
            // Message count is updated in addMessage function
            
            // Extract topics
            extractTopics(message.toLowerCase());
        }
        
        // Update session timer
        function updateSessionTimer() {
            const now = new Date();
            const diffMs = now - sessionStartTime;
            const diffMins = Math.floor(diffMs / 60000);
            document.getElementById('sessionTime').textContent = diffMins;
        }
        
        // Save to notes
        function saveToNotes(content) {
            // Get existing notes or create new array
            const notes = JSON.parse(localStorage.getItem('chatNotes') || '[]');
            
            // Add new note with timestamp
            notes.push({
                content: content,
                timestamp: new Date().toISOString(),
                type: 'chat'
            });
            
            // Save back to localStorage
            localStorage.setItem('chatNotes', JSON.stringify(notes));
            
            showNotification('Message saved to notes!', 'success');
        }
        
        // Show notification
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 3000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                display: flex;
                align-items: center;
                gap: 0.5rem;
            `;
            
            if (type === 'success') {
                notification.style.background = 'var(--success)';
                notification.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            } else if (type === 'error') {
                notification.style.background = 'var(--danger)';
                notification.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            } else {
                notification.style.background = 'var(--primary)';
                notification.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
            }
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>